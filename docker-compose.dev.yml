services:
  rtl433dp-ui:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: rtl433dp-ui-dev
    ports:
      - "5173:5173"
    # Option 1: set env here (Vite reads VITE_* at start time)
    environment:
      VITE_API_BASE_URL: "http://host.docker.internal:8080"
      VITE_OIDC_AUTHORITY: "https://keycloak.brulenet.dev/realms/homelab"
      VITE_OIDC_CLIENT_ID: "rtl433dps-ui"
      VITE_OIDC_REDIRECT_URI: "http://localhost:5173/auth/callback"
      VITE_OIDC_POST_LOGOUT_REDIRECT_URI: "http://localhost:5173/"
      VITE_OIDC_SCOPE: "openid profile email"

      # Improves file watching reliability on some Docker setups.
      CHOKIDAR_USEPOLLING: "true"
    # Option 2: comment out 'environment' above and uncomment this to use your .env.local
    # env_file:
    #   - .env.local

    volumes:
      - .:/app
      # Keep node_modules in a named volume so it matches the container OS/arch
      - rtl433_ui_node_modules:/app/node_modules

    # Make host.docker.internal work on Linux (Docker Engine)
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  rtl433_ui_node_modules:
